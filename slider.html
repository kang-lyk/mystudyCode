<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<title>幻灯</title>
<style>
*{ padding: 0; margin: 0;}
ul,li,ol,dl,dt,dd {list-style: none;}
.slider,.slider-inner li {
    width: 500px;
    height: 200px;
    overflow: hidden;
}
.slider {
    position: relative;
}
.slider-inner li {
    float: left;  
}

.slider-pre,.slider-next {
    position: absolute;
    top: 62px;
    z-index: 1;
    background-color: rgba(0,0,0,.5);
    width: 50px;
    height: 67px;
    cursor: pointer;
}
.slider-pre {left: 0;}
.slider-next {right: 0;}
.slider-item {
    position: absolute;
    z-index: 1;
    bottom: 15px;
    width: 100%;
    text-align: center;
}
.slider-item li {
    border-radius: 50%;
    border: 1px solid #fff;
    display: inline-block;
    width: 10px;
    height: 10px;
    margin: 0 10px;
    cursor: pointer;
}
.slider-item li.active {
    background-color: #fff;
}
</style>
</head>
<body>

<div class="slider" data-options='{
    "auto":"true",
    "initIndex":"0",
    "animateTime":"500",
    "interval":"800"
}'>
    <ul class="slider-inner j-sBox">
        <li class="j-sItem">
            <img src="http://www.atool.org/placeholder.png?size=500x200&text=半神半圣亦半仙&bg=795548&fg=fff" alt="">
        </li>
        <li class="j-sItem">
            <img src="http://www.atool.org/placeholder.png?size=500x200&text=全儒全道是全贤&bg=4c4568&fg=fff" alt="">
        </li>
        <li class="j-sItem">
            <img src="http://www.atool.org/placeholder.png?size=500x200&text=脑中之书藏开卷&bg=7d6f3e&fg=fff" alt="">
        </li>
        <li class="j-sItem">
            <img src="http://www.atool.org/placeholder.png?size=500x200&text=掌握文武半边天&bg=4c4e9a&fg=fff" alt="">
        </li>
    </ul>
    <div class="slider-pre j-sPre"></div>
    <div class="slider-next j-sNext"></div>
    <!-- <ul class="slider-item">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul> -->
</div>

<script>
;(function(win,doc){
    'use strict'; //用“严格模式”
    // 
    function slider(){
        this.options = {
            auto:true,     //是否自动播放
            initIndex:0, //首屏所使用的数据列表索引
            animateTime:300, //动画时间
            interval:600,    // 场影间隔时间
            animateEasing: 'ease', //动画效果，可选 linear、ease、ease-in、ease-out、ease-in-out
            isVertical:false, //是非垂直展示
            domMain:'.j-sBox', //展示区
            domItem:'.j-sItem', //单个场影
            domPre:'.j-sPre', //上一个按钮
            domNext:'.j-sNext',//下一个按钮
            showItem:true, //是否显示小点
            showPre:true, //显示上一个
            showNext:true,//显示下一个
            callback:null // 回调 
        };  
    };
    /**
     * [extend 合并对象]
     * @return {[object]} [返回合并后的对像]
     */
    slider.prototype.extend = function(){           
        var arr = Array.prototype.slice.call(arguments), //把参数从伪数组转为数组
            newObj = {},
            arrLength = arr.length,
            resultObj = arr[0];
        for (var i = 1; i < arrLength; i++) {
            var obj = arr[i];
            for (var x in obj) {
                if (obj.hasOwnProperty(x)) { //排除掉原型链上的属性
                    newObj[x] = obj[x];
                };                
            };
        };
        for (var x in newObj) {
            resultObj[x] = newObj[x];
        };
        return resultObj;
    };
    /**
     * [setDefault 设置默认参数]
     * @param {[object]} options [幻灯的参数]
     */
    slider.prototype.setDefault = function(options){
        var defaultOptions = this.options;
        return this.extend(defaultOptions,options);
    };
    /**
     * [getOptions 取得新的参数]
     * @param  {[object]} dataOptions [旧的参数]
     * @param  {[object]} options     [你要设置的参数]
     * @return {[object]}             [新的参数]
     */
    slider.prototype.getOptions = function(dataOptions,options){
        var defaultOptions = this.options,
            newDataOptions = {};
        try {
            newDataOptions = JSON.parse(dataOptions);
        }catch(error){
            throw '请检查json字符串是否正确或浏览器是否支持JSON.parse';
        };
        return this.extend({},defaultOptions,options,newDataOptions);
    };
    /**
     * [hasAnimation 判断是非支持css3动画,并返回前缀]
     * @return {objcet} [has:是非支持动画，prefix：css前缀]
     */
    slider.prototype.hasAnimation = function(){
        var arr = ['MsAnimation','MozAnimation','WebkitAnimation','animation'], 
            i = arr.length,
            domStyle =document.createElement('div').style,
            obj = {
                has:false,
                prefix:''
            };
        while(i>0){
            i--;
            var str = arr[i];
            if (str in domStyle) {
                obj.has = true;
                obj.prefix = str.replace(/Animation/i,'');
                break;
            };
        };
        return obj;
    };
    // 
    /**
     * [init 开始运行幻灯]
     * @param  {[Object]} dom     [在运行幻灯的dom元素]
     * @param  {[Object]} options [description]
     * @return {[type]}         [description]
     */
    slider.prototype.init = function(dom,options){
        var hasAnimation = this.hasAnimation();
        this.prefix = hasAnimation.prefix;
        if (!hasAnimation.has) {
            throw '请下载支持css3动画的浏览器';
            return false;
        };
        var options = options || {},
            newOptions = this.newOptions = this.getOptions(dom.getAttribute('data-options'),options), // 取得新"设置参数"
            dom = this.dom = dom,
            domMain = this.domMain = dom.querySelector(newOptions.domMain),
            domItem = this.domItem = dom.querySelectorAll(newOptions.domItem),
            domPre = this.domPre = dom.querySelector(newOptions.domPre),
            domNext = this.domNext = dom.querySelector(newOptions.domNext),
            domStyle = getComputedStyle(dom),
            _width = parseInt(domStyle.width) + parseInt(domStyle.paddingLeft) + parseInt(domStyle.paddingRight),
            _heigth = parseInt(domStyle._heigth) + parseInt(domStyle.paddingTop) + parseInt(domStyle.paddingBottom),
            itemLength = this.itemLength = domItem.length,
            lastItem =  itemLength-1;

        domMain.appendChild(domItem[0].cloneNode(true));
        domMain.insertBefore(domItem[lastItem].cloneNode(true),domItem[0]);
        domMain.style.width = _width*(itemLength+2) + 'px';
       
        var that = this,
            translate = this.translate = newOptions.isVertical ? 'translateY' : 'translateX',
            oneWidth = this.oneWidth = 100/(itemLength+2);
        newOptions.initIndex = newOptions.initIndex*1;

        this.goIndex(); //
        // 点击到上一个
        domPre.onclick = function(){
            if (newOptions.initIndex > itemLength) {
                newOptions.initIndex = 0; 
            } else {
                newOptions.initIndex--; 
            };            
            that.goIndex(newOptions.initIndex);
        };
        // 点击到下一个
        domNext.onclick = function(){
            if (newOptions.initIndex > itemLength) {
                newOptions.initIndex = 0; 
            } else {
                newOptions.initIndex++; 
            };            
            that.goIndex(newOptions.initIndex);
        };
        // 监听动画结束时
        domMain.addEventListener('webkitTransitionEnd',function(){
            console.log(newOptions.initIndex);
            var domMainStyle = that.domMain.style;
            if (newOptions.initIndex >= itemLength) { //最后到第一个的情况
                newOptions.initIndex = 0;
                domMainStyle.cssText = 'width:' + _width*(itemLength+2) + 'px;';
                domMainStyle[that.prefix+'transform'] = translate+'(-'+that.oneWidth+'%)';
            } else if(newOptions.initIndex < 0) { //第一个到最后的情况
                newOptions.initIndex = lastItem;
                domMainStyle.cssText = 'width:' + _width*(itemLength+2) + 'px;';
                domMainStyle[that.prefix+'transform'] = translate+'(-'+that.oneWidth*itemLength+'%)';
            };
        },false);
    };
    /**
     * [goIndex 跳到第几个场景]
     * @param  {Boolean} isAnimate [true则进行动画]
     */
    slider.prototype.goIndex = function(isAnimate){
        var i = 0, 
            that = this,
            newOptions = this.newOptions,
            oneWidth = this.oneWidth,
            domMainStyle = this.domMain.style,
            domItem = this.domItem,
            cssPrefix = !!this.prefix ? '-'+this.prefix.toLowerCase()+'-' : '', //css3前缀
            transition = cssPrefix+'transform '+newOptions.animateTime+'ms '+newOptions.animateEasing,
            initIndex = newOptions.initIndex>-1 ? newOptions.initIndex+1 : newOptions.initIndex , //当前场景
            translate = this.translate; 
        if (isAnimate) {
            domMainStyle[this.prefix+'transition'] = transition;
            if (initIndex>0) {                
                domMainStyle[this.prefix+'transform'] = translate+'(-'+oneWidth*(initIndex)+'%)'; 
            }else{
                domMainStyle[this.prefix+'transform'] = translate+'(0%)';
            }
        } else {
            domMainStyle[this.prefix+'transform'] = translate+'(-'+oneWidth*(initIndex)+'%)';
        }
    };

    win.slider = slider;

/******************华丽的分隔线*******************/

    var focus = new slider();

    focus.setDefault({
        auto:false,
        animateTime:300, //动画时间
        nterval:600,    
        showItem:false
    });

    focus.init(doc.querySelector('.slider')); 

})(window,document);
</script>
</body>
</html>
